<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menú del Restaurante - Buho Eats</title>

    <!-- Tailwind -->
    <script src="../libs/tailwind.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3D405B',
                        secondary: '#588B8B',
                        accent: '#F2CC8F'
                    }
                }
            }
        };
    </script>

    <link rel="stylesheet" href="../assets/css/reset.css">
</head>

<body class="bg-gray-100" data-page="owner-menu">

    <!-- NAV -->
    <header class="bg-primary text-white py-4 px-6 shadow-lg">
        <h1 class="text-xl font-bold">Menú del Restaurante</h1>
    </header>

    <!-- CONTENT -->
    <main class="max-w-4xl mx-auto mt-10">

        <div class="bg-white p-6 rounded-xl shadow">

            <h2 class="text-2xl font-semibold text-primary mb-6">Platillos</h2>

            <!-- LISTA DEL MENÚ -->
            <div id="menuList" class="space-y-4 mb-8">
                <p class="text-gray-500">Cargando menú...</p>
            </div>

            <!-- AGREGAR NUEVO PLATILLO -->
            <h3 class="text-xl font-medium text-secondary mb-4">Agregar nuevo platillo</h3>

            <form id="addItemForm" class="space-y-5">

                <div>
                    <label class="font-medium">Nombre *</label>
                    <input id="itemName" class="w-full px-4 py-3 border rounded-lg mt-1" required>
                </div>

                <div>
                    <label class="font-medium">Descripción *</label>
                    <textarea id="itemDesc" class="w-full px-4 py-3 border rounded-lg mt-1" required></textarea>
                </div>

                <div>
                    <label class="font-medium">Precio *</label>
                    <input id="itemPrice" type="number" min="0.01" step="0.01"
                           class="w-full px-4 py-3 border rounded-lg mt-1" required>
                </div>

                <button class="w-full bg-secondary text-white py-3 rounded-lg hover:bg-opacity-90 transition">
                    Agregar platillo
                </button>

            </form>

        </div>

    </main>

    <!-- JS Files -->
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/api.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/owner.js"></script>

    <script>
        // PROTEGER PÁGINA
        if (!Auth.requireRole("owner")) return;

        async function loadMenu() {
            const container = document.getElementById("menuList");
            container.innerHTML = `<p class="text-gray-600">Cargando menú...</p>`;

            const menu = await Owner.getMenu();

            if (!menu || menu.length === 0) {
                container.innerHTML = `<p class="text-gray-500">No hay platillos agregados.</p>`;
                return;
            }

            container.innerHTML = "";

            menu.forEach(item => {
                const div = document.createElement("div");
                div.className =
                    "border p-4 rounded-lg shadow flex justify-between items-center hover:bg-gray-50 transition";

                div.innerHTML = `
                    <div>
                        <h4 class="font-bold text-primary">${item.name}</h4>
                        <p class="text-gray-600 text-sm">${item.description}</p>
                        <p class="font-medium mt-1 text-secondary">$${parseFloat(item.price).toFixed(2)}</p>
                    </div>

                    <button 
                        onclick="deleteItem('${item.id}')"
                        class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition">
                        Eliminar
                    </button>
                `;

                container.appendChild(div);
            });
        }

        loadMenu();

        document.getElementById("addItemForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const name = itemName.value.trim();
            const desc = itemDesc.value.trim();
            const price = parseFloat(itemPrice.value);

            if (!name || !desc || isNaN(price) || price <= 0) {
                Utils.showToast("Todos los campos son obligatorios", "error");
                return;
            }

            const newItem = { name, description: desc, price };

            const response = await Owner.addMenuItem(newItem);

            if (!response || !response.success) {
                Utils.showToast("Error al agregar platillo", "error");
                return;
            }

            Utils.showToast("Platillo agregado con éxito", "success");

            e.target.reset();
            loadMenu();
        });

        async function deleteItem(id) {
            if (!confirm("¿Seguro que deseas eliminar este platillo?")) return;

            const res = await Owner.deleteMenuItem(id);

            if (!res || !res.success) {
                Utils.showToast("Error al eliminar", "error");
                return;
            }

            Utils.showToast("Platillo eliminado", "warning");
            loadMenu();
        }
    </script>

</body>

</html>