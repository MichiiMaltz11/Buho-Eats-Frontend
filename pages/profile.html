<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mi Perfil - Buho Eats</title>
    
    <!-- Tailwind CSS (Offline) -->
    <script src="../libs/tailwind.js"></script>
    
    <!-- Configuración de Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3D405B',
                        secondary: '#588B8B',
                        success: '#06BB0C',
                        danger: '#C11D0C',
                    }
                }
            }
        }
    </script>
    
    <!-- CSS personalizado -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <style>
        /* Imagen de fondo con overlay oscuro */
        body {
            background-image: url('../assets/img/background.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            position: relative;
        }
        
        /* Overlay oscuro semitransparente */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.2);
            z-index: -1;
        }
        
        /* Espacio para el header fijo */
        main {
            padding-top: 120px !important;
            min-height: calc(100vh - 120px);
        }

        /* Preview de foto de perfil */
        .profile-photo-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #588B8B;
        }
    </style>
</head>
<body class="bg-gray-50" data-page="profile">
    <!-- MODAL DE CONFIRMACIÓN -->
    <div id="customDialog" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] hidden items-center justify-center">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all">
            <!-- Header del modal -->
            <div class="p-6">
                <h3 id="dialogTitle" class="text-2xl font-bold text-primary">
                </h3>
            </div>
            
            <!-- Contenido del modal -->
            <div class="p-6">
                <p id="dialogMessage" class="text-gray-600">
                </p>
            </div>
            
            <!-- Botones del modal -->
            <div class="p-6 flex gap-3">
                <button 
                    id="dialogCancelBtn" 
                    class="flex-1 px-6 py-3 bg-danger text-white rounded-lg font-semibold hover:bg-danger/90 transition-all transform hover:scale-105"
                    onclick="closeDialog(false)"
                >
                    Cancelar
                </button>
                <button 
                    id="dialogConfirmBtn" 
                    class="flex-1 px-6 py-3 bg-success text-white rounded-lg font-semibold hover:bg-success/90 transition-all transform hover:scale-105"
                    onclick="closeDialog(true)"
                >
                    Aceptar
                </button>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <div id="header-container"></div>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="container mx-auto px-4 py-8">
        <!-- Título de la página -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold text-primary mb-2">Mi Perfil</h2>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Foto de Perfil -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <h3 class="text-xl font-bold text-primary mb-6 text-center">Foto de Perfil</h3>
                    
                    <!-- Preview de la foto -->
                    <div class="flex justify-center mb-6">
                        <div class="relative">
                            <!-- Imagen de perfil -->
                            <img 
                                id="profilePhotoPreview" 
                                src="" 
                                alt="Foto de perfil" 
                                class="profile-photo-preview"
                                style="display: none;"
                                onerror="this.style.display='none'; document.getElementById('profilePhotoFallback').style.display='flex';"
                            >
                            <!-- Fallback con inicial -->
                            <div 
                                id="profilePhotoFallback"
                                class="profile-photo-preview bg-secondary flex items-center justify-center"
                                style="display: flex;"
                            >
                                <span id="profileInitial" class="text-white font-bold text-5xl">U</span>
                            </div>
                            
                            <!-- Badge de editar -->
                            <label 
                                for="photoInput"
                                class="absolute bottom-0 right-0 bg-secondary rounded-full p-2 shadow-lg cursor-pointer hover:bg-secondary/90 transition"
                            >
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </label>
                            
                            <!-- Loading overlay -->
                            <div 
                                id="uploadingOverlay" 
                                class="absolute inset-0 bg-black/50 rounded-full hidden items-center justify-center"
                            >
                                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Input de archivo oculto -->
                    <input 
                        type="file" 
                        id="photoInput" 
                        accept="image/jpeg,image/jpg,image/png,image/webp,image/gif" 
                        class="hidden" 
                        onchange="previewPhoto(event)"
                    >

                    <!-- Información de la foto -->
                    <div class="text-center mb-6">
                        <p class="text-xs text-gray-500">
                            Formatos: JPG, PNG, WebP, GIF • Máx: 5MB
                        </p>
                    </div>

                    <!-- Botón de eliminar foto -->
                    <div class="space-y-3">
                        <button 
                            type="button"
                            onclick="removePhoto()"
                            class="w-full bg-danger text-white px-6 py-3 rounded-lg font-semibold hover:bg-danger/90 transition flex items-center justify-center gap-2"
                        >
                            Eliminar Foto
                        </button>
                    </div>
                </div>
            </div>

            <!-- Información Personal -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <h3 class="text-xl font-bold text-primary mb-6">Información Personal</h3>
                    
                    <form id="profileForm" onsubmit="saveProfile(event)">
                        <!-- Nombre -->
                        <div class="mb-6">
                            <label for="firstName" class="block text-gray-700 font-semibold mb-2">
                                Nombre <span class="text-danger">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="firstName" 
                                name="firstName"
                                value="Juan"
                                required
                                minlength="2"
                                maxlength="50"
                                pattern="[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+"
                                title="Solo se permiten letras y espacios"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent"
                                placeholder="Ingresa tu nombre"
                            >
                        </div>

                        <!-- Apellido -->
                        <div class="mb-6">
                            <label for="lastName" class="block text-gray-700 font-semibold mb-2">
                                Apellido <span class="text-danger">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="lastName" 
                                name="lastName"
                                value="Pérez"
                                required
                                minlength="2"
                                maxlength="50"
                                pattern="[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+"
                                title="Solo se permiten letras y espacios"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent"
                                placeholder="Ingresa tu apellido"
                            >
                        </div>

                        <!-- Correo -->
                        <div class="mb-6">
                            <label for="email" class="block text-gray-700 font-semibold mb-2">
                                Correo Electrónico <span class="text-danger">*</span>
                            </label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email"
                                value="juan.perez@example.com"
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent"
                                placeholder="correo@ejemplo.com"
                            >
                        </div>

                        <!-- Separador -->
                        <hr class="my-8">
                        <h4 class="text-lg font-bold text-primary mb-6">Cambiar Contraseña</h4>

                        <!-- Contraseña Actual -->
                        <div class="mb-6">
                            <label for="currentPassword" class="block text-gray-700 font-semibold mb-2">
                                Contraseña Actual
                            </label>
                            <div class="relative">
                                <input 
                                    type="password" 
                                    id="currentPassword" 
                                    name="currentPassword"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent pr-12"
                                    placeholder="Ingresa tu contraseña actual"
                                >
                                <button 
                                    type="button"
                                    onclick="togglePassword('currentPassword')"
                                    class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
                                >
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Nueva Contraseña -->
                        <div class="mb-6">
                            <label for="newPassword" class="block text-gray-700 font-semibold mb-2">
                                Nueva Contraseña
                            </label>
                            <div class="relative">
                                <input 
                                    type="password" 
                                    id="newPassword" 
                                    name="newPassword"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent pr-12"
                                    placeholder="Ingresa tu nueva contraseña"
                                >
                                <button 
                                    type="button"
                                    onclick="togglePassword('newPassword')"
                                    class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
                                >
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Confirmar Nueva Contraseña -->
                        <div class="mb-8">
                            <label for="confirmPassword" class="block text-gray-700 font-semibold mb-2">
                                Confirmar Nueva Contraseña
                            </label>
                            <div class="relative">
                                <input 
                                    type="password" 
                                    id="confirmPassword" 
                                    name="confirmPassword"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-transparent pr-12"
                                    placeholder="Confirma tu nueva contraseña"
                                >
                                <button 
                                    type="button"
                                    onclick="togglePassword('confirmPassword')"
                                    class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
                                >
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Botones de acción -->
                        <div class="flex gap-4">
                            <button 
                                type="submit"
                                class="flex-1 bg-success text-white px-6 py-3 rounded-lg font-semibold hover:bg-success/90 transition-all transform hover:scale-105"
                            >
                                Guardar Cambios
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <div id="footer-container"></div>

    <!-- Scripts -->
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/dialog.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/header.js"></script>
    <script src="../assets/js/profile.js"></script>
    
    <script>
        // Función de logout con diálogo de confirmación
        function logout() {
            showDialog({
                title: 'Cerrar Sesión',
                message: '¿Estás seguro de que deseas cerrar sesión?',
                confirmText: 'Aceptar',
                cancelText: 'Cancelar',
                onConfirm: function() {
                    Auth.logout().catch(err => console.error('Error en logout:', err));
                }
            });
        }
    </script>
</body>
</html>
